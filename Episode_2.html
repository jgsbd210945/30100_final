<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jason Gordon">
<meta name="dcterms.date" content="2025-03-13">

<title>Shifts in Values, Shifts in Democracy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Episode_2_files/libs/clipboard/clipboard.min.js"></script>
<script src="Episode_2_files/libs/quarto-html/quarto.js"></script>
<script src="Episode_2_files/libs/quarto-html/popper.min.js"></script>
<script src="Episode_2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Episode_2_files/libs/quarto-html/anchor.min.js"></script>
<link href="Episode_2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Episode_2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Episode_2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Episode_2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Episode_2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Shifts in Values, Shifts in Democracy</h1>
            <p class="subtitle lead">Identifying Correlations between World Values Survey Responses and Level of Electoral Democracy</p>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Jason Gordon <a href="mailto:jagordon@uchicago.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://www.uchicago.edu/">
              The University of Chicago
              </a>
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 13, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      This project combines the World Values Survey data with V-DEM’s electoral democracy score, seeking to identify correlations between people’s values and their state’s level of democracy - and if it will undergo democratic backsliding. You can find the project at <a href="">https://github.com/jgsbd210945/30100_final</a>.
    </div>
  </div>
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content quarto-banner-title-block" id="quarto-document-content">





<div style="page-break-after: always;"></div>
<section id="intoduction" class="level2">
<h2 class="anchored" data-anchor-id="intoduction">Intoduction</h2>
<p>Democratic backsliding has increasingly taken hold of the world, with the Varieties of Democracy (V-DEM) 2024 Democracy Report identifying 28 cases of backsliding in democracies, 13 of which having reverted to autocracies since the episode began.<span class="citation" data-cites="nordDemocracyReport20242024"><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></span> As backsliding occurs within democracies with elected leaders, there is seemingly popular support <em>against</em> democracy in these countries — at least given the results of these elections. So, what shifts in an electorate’s values are the most important to backsliding, and can we use machine learning techniques to predict the onset of backsliding?</p>
<p>In this paper, I plan to inspect if the wave of autocratization in democracies is the result of a shift in values against democracy, and which values are the most important for the shift to autocracy. As the number of cases of backsliding increases, it becomes increasingly important to understand why people would vote for actors that seek to challenge the core foundation of democratic institutions; with this knowledge, we may be able to further understand when cases of backsliding can happen.</p>
<p>First, I will be summarizing existing literature on democratic backsliding, identifying the tension in what causes backsliding. Then, I will conduct some exploratory data analysis and model fitting of my dataset, using Lasso to identify notable variables. Finally, I will discuss if these variables have importance in conducting future research.</p>
</section>
<section id="existing-literature" class="level2">
<h2 class="anchored" data-anchor-id="existing-literature">Existing Literature</h2>
<p>Over the past twenty-five years, there has been considerable discussion about the causes of democratic backsliding - defined generally as the gradual breakdown of democratic institutions through nonviolent — and often, legal — means.<span class="citation" data-cites="haggardBackslidingDemocraticRegress2021 levitskyHowDemocracies2018a"><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></span> Most discussions claim polarization is the core idea behind why democracies denigrate, but little is known about the shifts in values to <em>why</em> it happens.</p>
<p>Haggard and Kaufman (2021a) discuss backsliding through the lens of dysfunction of a lack of trust in institutions, which permit autocrats to capture the executive.<span class="citation" data-cites="haggardAnatomyDemocraticBacksliding2021"><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></span> These scholars point to an overall frustration with the system leading to polarization, as anti-system actors may be able to succeed in taking power if the population has no faith that the system will perform well with them. Other literature seems to correlate parts of this claim, with Cooley and Nexon (2020) arguing that these are akin to a “counter-order” movement, made in rejection to the liberal system of ordering.<span class="citation" data-cites="cooleyExitHegemonyUnraveling2020"><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></span> Generally, these scholars agree that movements and politicians rejecting the structure of governance as it stands currently obtain success, with Haggard and Kaufman finding it is due to dissatisfaction in institutions.</p>
<p>However, Carothers and Press (2022) expand on this discussion, first limiting their discussion to the Global South and post-communist Europe, and delivering three separate categories of democratic backsliding, all of which create differing interpretations of the values behind backsliding. They state that backsliding can be caused by grievance-fueled illiberalism, agreeing with future literature that frustrations in institutions can drive backsliding; opportunistic authoritarianism, where autocrats act as political entrepreneurs to obtain power; and entrenched-interest revanchinism, where an interest group uses undemocratic means to reassert its claim.<span class="citation" data-cites="carothersUnderstandingRespondingGlobal2022"><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></span> Carothers and Press’s framework gives an idea for the potential variance in the viewpoints behind backsliding, claiming it is not as simple as people being mad about institutions failing them.</p>
<p>An additional perspective claims that backsliding isn’t domestic in nature, but international. One such scholar, Anna Meyerrose (2020; 2021), finds that instead of backsliding being triggered by domestic parties, that international organizations (IOs) are to blame. She claims that because IOs focus on elections and an increase in executive power in their democracy promotion, in addition to removing some areas of policy for political parties to divide on, potential autocrats have an easier time gaining and maintaining power.<span class="citation" data-cites="meyerroseInternationalSourcesDemocratic2021 meyerroseUnintendedConsequencesDemocracy2020"><a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></span> Deviating from other arguments, this branch of literature finds that while there may be domestic issues, structural problems make backsliding <em>much</em> more likely. As a result, backsliding may have nothing to do with values populations have.</p>
<p>I intend to put these differing claims to the test. While I expect that grievances with institutions play a not insignificant role in democratic backsliding, I do expect there to be variance in how much of a role it plays. Some states may backslide due to structural issues, or for electing a leader who at first may adhere to democratic norms, but then turn against the system later in their term.</p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>I plan to utilize the World Values Survey’s (WVS) seventh wave of data to account for the values I plan to inspect, pairing the averages of responses with the correlating electoral democracy scores found in the Varieties of Democracy’s (V-DEM) data set.</p>
<p>While both are relatively large sources of data, combining the two results in just 62 observations; since WVS uses different questions between years, I cannot discuss it over time, leading to, unfortunately, a rather limited amount of data to analyze. Despite this, there are few other limitations between the two data sets. Both plot their results on a scale, meaning there are no significant outlying values, and they are both trusted sources of data used across the literature.</p>
<p>While I will focus on all questions in the WVS data, I plan on focusing on the electoral democracy and regime scores in the V-DEM data set. The electoral democracy index seeks to identify the structural components in a democracy; that is, are elections free and fair, and are the rights required for democratic rule generally followed? Alongside this, I will be collecting the overall regime type in the data, which puts all states on a ten-point scale from most to least democratic.</p>
<p>I will also create two additional variables, which I also aim to test to understand if a state is undergoing democratic backsliding: the difference in electoral democracy score, and a Boolean value for if a state is in a period of backsliding, defined below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>workingvdem <span class="ot">&lt;-</span> <span class="fu">tibble</span>(vdem) <span class="sc">|&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1975</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_text_id) <span class="sc">|&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_polyarchy =</span> v2x_polyarchy <span class="sc">-</span> <span class="fu">lag</span>(v2x_polyarchy)) <span class="sc">|&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Backsliding boolean variable.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I'm quantitatively defining it as having decreased in electoral</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># democracy score by more than .005 and having decreased by at</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># least 0.03 in the last two years.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I also filtered so that the regime has to be at least some semblance</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of an electoral autocracy (at least) so that hard autocracies getting</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># more autocratic aren't included.</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">backslided =</span> (diff_polyarchy <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.005</span>) <span class="sc">&amp;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>           (v2x_regime_amb <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">&amp;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>           (<span class="fu">lag</span>(v2x_polyarchy, <span class="dv">2</span>) <span class="sc">-</span> v2x_polyarchy <span class="sc">&gt;</span> <span class="fl">0.03</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filling it out</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">backslided =</span> (diff_polyarchy <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.001</span>) <span class="sc">&amp;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>           (backslided <span class="sc">|</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>              ((<span class="fu">lag</span>(backslided) <span class="sc">&amp;</span> <span class="fu">lag</span>(backslided, <span class="dv">2</span>))<span class="sc">|</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">lead</span>(backslided) <span class="sc">&amp;</span> <span class="fu">lag</span>(backslided) <span class="sc">|</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">lead</span>(backslided, <span class="dv">2</span>) <span class="sc">&amp;</span> <span class="fu">lead</span>(backslided)))) <span class="sc">|&gt;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(country_text_id) <span class="sc">|&gt;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country_name,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>         country_text_id,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>         year,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>         v2x_polyarchy,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>         v2x_libdem, </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>         v2x_regime_amb, </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>         diff_polyarchy, </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>         backslided)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By defining a period of backsliding in an overall shift from democracy that does <em>not</em> have to be a sharp decline every year, I can create clear periods of backsliding, easily identifying cases.</p>
<p>In addition to creating these variables, I will be cleaning both data sets and attempting to standardize missing values if I cannot remove them, which will hopefully make my data as accurate as possible. This should also allow me to merge the V-DEM and WVS data without hassle.</p>
<section id="exploratory-analysis" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-analysis">Exploratory Analysis</h3>
<p>To determine which features are the most important to a shift in electoral democracy score, I plan on using a Lasso model, testing the electoral democracy score to get the most important variables. While using the difference in this score may seem more intuitive, its low variance results in the model being unable to get the top features.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Episode_2_files/figure-html/lassosetup-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Episode_2_files/figure-html/lassosetup-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Given our cross-validation graph indicates our most important features will be somewhere between 10 and 15, we can then discuss which variables are the most important, as seen below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>top_features <span class="ot">&lt;-</span> <span class="fu">coef</span>(cv_out, <span class="at">s =</span> <span class="st">"lambda.1se"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>top_features <span class="ot">&lt;-</span> top_features[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>top_features <span class="ot">&lt;-</span> top_features[top_features <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">abs</span>(top_features), <span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Q211         Q239          Q38         Q212         Q271         Q225 
0.1967821941 0.0559778577 0.0482793422 0.0480802239 0.0364528223 0.0228602491 
         Q73           Q3        Q292I         Q182         Q262 
0.0190355263 0.0151253037 0.0107729186 0.0044779803 0.0001399158 </code></pre>
</div>
</div>
<p>Thus, the most impactful questions on the democracy score are as follows, alongside the graph of how important they are (with further away from 0 indicating increased important as more factors are added):</p>
<ul>
<li>Q211 <em>(Openness to attending a political demonstration)</em></li>
<li>Q239 <em>(Opinion on religious law governing a country)</em></li>
<li>Q38 <em>(Is it a child’s duty to take care of a sick parent?)</em></li>
<li>Q212 <em>(Openness to joining unofficial strikes)</em></li>
<li>Q271 <em>(If the respondent is living with their parents)</em></li>
<li>Q225 <em>(Frequency of opposition candidates prevented from running)</em></li>
<li>Q73 <em>(Confidence in country’s parliament)</em></li>
<li>Q3 <em>(Importance of leisure time)</em></li>
<li>Q292I <em>(Belief politicians are incompetent or ineffective)</em></li>
<li>Q182 <em>(Is homosexuality justifiable?)</em></li>
<li>Q262 <em>(Age)</em></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Episode_2_files/figure-html/lassoresults-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Many of these reflect core foundations of democracy, but there are some that seem more cultural. We can see notable trends in political demonstrations highly correlating with overall level of electoral democracy; Q211 and Q212 are among the first variables given coefficients, and Q211 has the largest overall effect. This makes sense, as generally, an increased level to take public action for political reasons would increase the level of accountability leaders have to their people.</p>
<p>Additionally, Wave 7 denotes variables like confidence in parliament, belief politicians are incompetent or ineffective, and frequency of opposition candidates being prevented from running. These all directly tie into whether electoral democracy is healthy, as if opposition candidates are not allowed to run, overall level of democracy decreases, and the last of these variables is one of the metrics V-DEM also measures to indicate level of electoral democracy.</p>
<p>Finally, the belief that the government and its actors may be ineffective make sense to discuss both electoral democracy and backsliding. As a population’s trust of its government falls, it often polarizes and seeks anti-system candidates, resulting in an increased likelihood of a potential autocrat’s election.</p>
</section>
</section>
<section id="modeling" class="level2">
<h2 class="anchored" data-anchor-id="modeling">Modeling</h2>
<p>To test if I can predict electoral democracy levels and backsliding, I decided to use decision trees, in an attempt to classify based on the different variables we got from Lasso. I tested two trees, finding that there is no major difference between RandomForest and XGBoost for trees, as seen below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>wf_set <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(rec),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> <span class="fu">list</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">xgboost =</span> model_xgboost,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">random_forest =</span> model_rf100)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>wf_set_fitted <span class="ot">&lt;-</span> <span class="fu">workflow_map</span>(wf_set, <span class="st">"fit_resamples"</span>, <span class="at">resamples =</span> cv_folds)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>wf_set_fitted <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 9
  wflow_id          .config preproc model .metric .estimator  mean     n std_err
  &lt;chr&gt;             &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 recipe_xgboost    Prepro… recipe  boos… rmse    standard   0.160     5  0.0266
2 recipe_xgboost    Prepro… recipe  boos… rsq     standard   0.583     5  0.122 
3 recipe_random_fo… Prepro… recipe  rand… rmse    standard   0.172     5  0.0211
4 recipe_random_fo… Prepro… recipe  rand… rsq     standard   0.606     5  0.0954</code></pre>
</div>
</div>
<p>However, I will use XGBoosted trees to focus on the variables, creating 500 trees in an attempt for increased accuracy. I also plan on tuning for the learning rate hyperparameter. Below are the results for my initial model. I will then get the best fit and use it to make our final predictions, seen compared to our predictions in the graph below. The red like is a perfect prediction, that is, the prediction is the same as the actual value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>xg_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">learn_rate</span>(), <span class="at">levels =</span> <span class="dv">5</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>model_xgboost_tune <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="dv">500</span>, <span class="at">mtry=</span><span class="dv">5</span>, <span class="at">learn_rate =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(model_xgboost_tune) <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(rec)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>model_res <span class="ot">&lt;-</span> wf <span class="sc">|&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> cv_folds,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> xg_grid,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(model_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
     learn_rate .metric .estimator    mean     n std_err .config             
          &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
 1 0.0000000001 rmse    standard     0.254     5  0.0111 Preprocessor1_Model1
 2 0.0000000001 rsq     standard   NaN         0 NA      Preprocessor1_Model1
 3 0.0000000178 rmse    standard     0.254     5  0.0111 Preprocessor1_Model2
 4 0.0000000178 rsq     standard   NaN         0 NA      Preprocessor1_Model2
 5 0.00000316   rmse    standard     0.254     5  0.0111 Preprocessor1_Model3
 6 0.00000316   rsq     standard     0.582     5  0.109  Preprocessor1_Model3
 7 0.000562     rmse    standard     0.227     5  0.0126 Preprocessor1_Model4
 8 0.000562     rsq     standard     0.574     5  0.106  Preprocessor1_Model4
 9 0.1          rmse    standard     0.184     5  0.0261 Preprocessor1_Model5
10 0.1          rsq     standard     0.500     5  0.0909 Preprocessor1_Model5</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Episode_2_files/figure-html/finalfit-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Seemingly, there is still a large amount of variation in our model, likely due to a low sample size. A larger sample could predict better - as the higher electoral democracy scores are a bit more precise - though there is no way to get this data, as the questions on the World Values Survey are inconsistent.</p>
<p>I will also attempt to run the model on the full data, in case we missed any parameters. However, as seen below, there is no significant difference outside of random shifts due to splitting the entire data.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Episode_2_files/figure-html/fulldata-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I also will be testing this model on two more variables: the difference in electoral democracy score, which indicates backsliding, and the Boolean variable indicating if a state is in a backsliding episode. Below is the prediction for difference in electoral democracy score.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Episode_2_files/figure-html/diffpolyarchy-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Seemingly, the model did decently for differences in electoral democracy score, but that may be because the actual differences are close to zero, making it easy for the model to predict. Additionally, we can see if the model predicts if a state is in an episode of backsliding, with the ROC Curve below</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Episode_2_files/figure-html/backslided-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>final_class <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  .metric     .estimator .estimate .config             
  &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 accuracy    binary         0.645 Preprocessor1_Model1
2 roc_auc     binary         0.283 Preprocessor1_Model1
3 brier_class binary         0.297 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>Arguably, this data is little better than random selection, with large steps indicating a small sample size and not much else. With a 64.5% accuracy, it may be marginally better than pure random selection, but likely not by a significant amount.</p>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>While the global shift to autocracy is bolstered by an overall frustration in democratic institutions, it is by no means the only factor. This research confirms the theoretical claim that backsliding is correlated with an increase in frustrations with democratic institutions, but offers other potential variables like democratic activism and is not a useful predictive model.</p>
<p>Below are the various VIP plots for each model. Here, we can see the various questions among each graph which may be the most important.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Episode_2_files/figure-html/vip-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Episode_2_files/figure-html/vip-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Episode_2_files/figure-html/vip-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Episode_2_files/figure-html/vip-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The most important features for each model (above 0.1 importance) are as follows:</p>
<ul>
<li><strong>Electoral Democracy Score:</strong>
<ul>
<li>Q212 (Political Action: Joining Unofficial Strikes)</li>
<li>Q211 (Political Action: attending lawful/peaceful demonstrations)</li>
<li>Q239 (Opinion on religious law)</li>
<li>Q262 (Age)</li>
</ul></li>
<li><strong>Electoral Democracy Score (with all parameters):</strong>
<ul>
<li>Q291UN3 (The UN usually acts in its own interests)</li>
<li>Q209 (Political Action: signing a petition)</li>
<li>Q219 (Political Action Online: encouraging others to take action)</li>
</ul></li>
<li><strong>Difference in ED Score:</strong>
<ul>
<li>Q33_3 (Jobs Scarce: Men should have more right to a job than woken)</li>
<li>Q73 (Confidence in Parliament)</li>
<li>Q3 (Important in Life: leisure time)</li>
<li>Q31 (Men make better business executives than women)</li>
<li>Q35_3 (Problem if men have more income than women)</li>
</ul></li>
<li><strong>Whether a state is in a backsliding episode:</strong>
<ul>
<li>Q35_3 (Problem if men have more income than women)</li>
<li>Q3 (Important in Life: leisure time)</li>
<li>Q39 (People who don’t work turn lazy)</li>
<li>Q262 (Age)</li>
</ul></li>
</ul>
<p>My initial hypothesis of frustration in institutions causing backsliding seems to somewhat be important, as confidence in a state’s parliament is important in the model predicting difference in electoral democracy score, and is flagged in the Lasso prediction, but otherwise, it is refuted. Instead, gender issues frequent those that are important in differences in electoral democracy score and backsliding episodes. However, gendered questions making backsliding more or less likely does make make sense, as increasing gender gaps drove Donald Trump - someone who, under his first term, ushered in a period of backsliding - to victory in November 2024.<span class="citation" data-cites="goldmacherDonaldTrumpReturns2024 levitskyHowDemocracies2018a"><a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></span></p>
<p>However, these results present an additional correlation: that of democratic activism. In both electoral democracy models, political activism proved somewhat important multiple times. This correlation somewhat tracks with the fact that free speech has more restrictions in more autocratic regimes, but the questions ask if someone is <em>willing</em> to join in the political action, so those states with higher proportions of people willing to resist likely are more democratic as a result.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Thus, the level of democracy in a state - at least to some extent - is affected by the values of its population. If people are dissatisfied with the government and will rarely take political action, an autocratic regime is more likely, and an increased paternal bias inside a state correlates with backsliding episodes. Using these correlations, we may be able to predict backsliding for future states, furthering our understanding of this shift from democracy in an ever-changing world.</p>
<p>With more resources and time, I may have been able to improve the model with an increase in data by asking questions like those on the World Values Survey and gathering an eighth wave of data, effectively doubling my data set. My challenge - and the one that impacted my results the most - was a lack of data, since the WVS is taken once every few years in a single country, and has different questions in each wave. Due to this, I could only effectively use one wave of data for modeling, creating difficulties in my model’s overall viability. If I could gather a new set of responses to these questions, I would be able to use that data to increase my model’s accuracy, potentially giving different results and predicting backsliding episodes more effectively.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-carothersUnderstandingRespondingGlobal2022" class="csl-entry" role="listitem">
Carothers, Thomas, and Benjamin Press. <span>“Understanding and <span>Responding</span> to <span>Global Democratic Backsliding</span>.”</span> Carnegie Endowment for International Peace, October 2022.
</div>
<div id="ref-cooleyExitHegemonyUnraveling2020" class="csl-entry" role="listitem">
Cooley, Alexander, and Daniel Nexon. <em>Exit from <span>Hegemony</span>: <span>The Unraveling</span> of the <span>American Global Order</span></em>. Oxford, New York: Oxford University Press, 2020.
</div>
<div id="ref-goldmacherDonaldTrumpReturns2024" class="csl-entry" role="listitem">
Goldmacher, Shane, and Lisa Lerer. <span>“Donald <span>Trump Returns</span> to <span>Power</span>, <span>Ushering</span> in <span>New Era</span> of <span>Uncertainty</span>.”</span> <em>The New York Times</em>, November 2024.
</div>
<div id="ref-haggardBackslidingDemocraticRegress2021" class="csl-entry" role="listitem">
Haggard, Stephan, and Robert Kaufman. <em>Backsliding: <span>Democratic Regress</span> in the <span>Contemporary World</span></em>. Elements in <span>Political Economy</span> 9. Cambridge University Press, 2021.
</div>
<div id="ref-haggardAnatomyDemocraticBacksliding2021" class="csl-entry" role="listitem">
———. <span>“The <span>Anatomy</span> of <span>Democratic Backsliding</span>.”</span> <em>Journal of Democracy</em> 32, no. 4 (2021): 27–41.
</div>
<div id="ref-levitskyHowDemocracies2018a" class="csl-entry" role="listitem">
Levitsky, Steven, and Daniel Ziblatt. <em>How <span>Democracies Die</span></em>. First edition. New York: Crown, 2018.
</div>
<div id="ref-meyerroseInternationalSourcesDemocratic2021" class="csl-entry" role="listitem">
Meyerrose, Anna M. <span>“International <span>Sources</span> of <span>Democratic Backsliding</span>.”</span> In <em>Routledge <span>Handbook</span> of <span>Illiberalism</span></em>. Routledge, 2021.
</div>
<div id="ref-meyerroseUnintendedConsequencesDemocracy2020" class="csl-entry" role="listitem">
———. <span>“The <span>Unintended Consequences</span> of <span>Democracy Promotion</span>: <span>International Organizations</span> and <span>Democratic Backsliding</span>.”</span> <em>Comparative Political Studies</em> 53, no. 10-11 (September 2020): 1547–81. <a href="https://doi.org/10.1177/0010414019897689">https://doi.org/10.1177/0010414019897689</a>.
</div>
<div id="ref-nordDemocracyReport20242024" class="csl-entry" role="listitem">
Nord, Marina, Martin Lundstedt, David Altman, Fabio Angiolillo, Cecilia Borella, Tiago Fernandes, Lisa Gastaldi, Ana Good God, Natalia Natsika, and Staffan Lindberg. <span>“Democracy <span>Report</span> 2024: <span>Democracy Winning</span> and <span>Losing</span> at the <span>Ballot</span>.”</span> University of Gothenburg: V-Dem Institute, March 2024.
</div>
</div>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><a href="#ref-nordDemocracyReport20242024" role="doc-biblioref">Marina Nord et al., <span>“Democracy <span>Report</span> 2024: <span>Democracy Winning</span> and <span>Losing</span> at the <span>Ballot</span>”</span> (University of Gothenburg: V-Dem Institute, March 2024)</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a href="#ref-haggardBackslidingDemocraticRegress2021" role="doc-biblioref">Stephan Haggard and Robert Kaufman, <em>Backsliding: <span>Democratic Regress</span> in the <span>Contemporary World</span></em>, Elements in <span>Political Economy</span> 9 (Cambridge University Press, 2021)</a>; <a href="#ref-levitskyHowDemocracies2018a" role="doc-biblioref">Steven Levitsky and Daniel Ziblatt, <em>How <span>Democracies Die</span></em>, First edition (New York: Crown, 2018)</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><a href="#ref-haggardAnatomyDemocraticBacksliding2021" role="doc-biblioref">Stephan Haggard and Robert Kaufman, <span>“The <span>Anatomy</span> of <span>Democratic Backsliding</span>,”</span> <em>Journal of Democracy</em> 32, no. 4 (2021): 27–41</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p><a href="#ref-cooleyExitHegemonyUnraveling2020" role="doc-biblioref">Alexander Cooley and Daniel Nexon, <em>Exit from <span>Hegemony</span>: <span>The Unraveling</span> of the <span>American Global Order</span></em> (Oxford, New York: Oxford University Press, 2020)</a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p><a href="#ref-carothersUnderstandingRespondingGlobal2022" role="doc-biblioref">Thomas Carothers and Benjamin Press, <span>“Understanding and <span>Responding</span> to <span>Global Democratic Backsliding</span>”</span> (Carnegie Endowment for International Peace, October 2022)</a>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p><a href="#ref-meyerroseInternationalSourcesDemocratic2021" role="doc-biblioref">Anna M. Meyerrose, <span>“International <span>Sources</span> of <span>Democratic Backsliding</span>,”</span> in <em>Routledge <span>Handbook</span> of <span>Illiberalism</span></em> (Routledge, 2021)</a>; <a href="#ref-meyerroseUnintendedConsequencesDemocracy2020" role="doc-biblioref">Anna M. Meyerrose, <span>“The <span>Unintended Consequences</span> of <span>Democracy Promotion</span>: <span>International Organizations</span> and <span>Democratic Backsliding</span>,”</span> <em>Comparative Political Studies</em> 53, no. 10-11 (September 2020): 1547–81, <span role="doc-biblioref">https://doi.org/10.1177/0010414019897689</span></a>.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p><a href="#ref-goldmacherDonaldTrumpReturns2024" role="doc-biblioref">Shane Goldmacher and Lisa Lerer, <span>“Donald <span>Trump Returns</span> to <span>Power</span>, <span>Ushering</span> in <span>New Era</span> of <span>Uncertainty</span>,”</span> <em>The New York Times</em>, November 2024</a>; <a href="#ref-levitskyHowDemocracies2018a" role="doc-biblioref">Levitsky and Ziblatt, <em>How <span>Democracies Die</span></em></a>.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>